---
layout: post
title:  "Tips | get naver news comment"
description: ğŸ“° ì›¹ ìŠ¤í¬ë˜í•‘ - ë„¤ì´ë²„ ë‰´ìŠ¤ ê¸°ì‚¬ ëŒ“ê¸€ ìˆ˜ì§‘í•˜ê¸°<br/><br/><img src='/assets/img/naver_news_comment/naver_news.png' width='90%'>
date:   2022-10-04 00:00:09 +0900
categories: Tips
style: fill
color: danger
tags: [Web Scraping, News, Comments, Crawling]
---
# ì›¹ ìŠ¤í¬ë˜í•‘ - ë„¤ì´ë²„ ë‰´ìŠ¤ ê¸°ì‚¬ ëŒ“ê¸€ ìˆ˜ì§‘í•˜ê¸°

[ì£¼ì˜í• ì ]
1. ë„¤ì´ë²„ ë‰´ìŠ¤ ê¸°ì‚¬ ëŒ“ê¸€ -> headerì— "referer"ì„ ì¶”ê°€í•´ì£¼ì–´ì•¼ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
2. ë„¤ì´ë²„ ë‰´ìŠ¤ ê¸°ì‚¬ ëŒ“ê¸€ì€ `ë”ë³´ê¸°` ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ë” ë§ì€ ëŒ“ê¸€ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
3. `''`ìœ¼ë¡œ ìˆ˜ì§‘ëœ ëŒ“ê¸€ì€ `ì‚­ì œëœ ëŒ“ê¸€`ì´ë‹¤.


ë‹¤ìŒ [ë§í¬](https://hoonzi-text.tistory.com/4)ë¥¼ ì°¸ê³ í•˜ì˜€ë‹¤.
<br/>

---
- [ì›¹ ìŠ¤í¬ë˜í•‘ - ë„¤ì´ë²„ ë‰´ìŠ¤ ê¸°ì‚¬ ëŒ“ê¸€ ìˆ˜ì§‘í•˜ê¸°](#ì›¹-ìŠ¤í¬ë˜í•‘---ë„¤ì´ë²„-ë‰´ìŠ¤-ê¸°ì‚¬-ëŒ“ê¸€-ìˆ˜ì§‘í•˜ê¸°)
  - [ë„¤ì´ë²„ ë‰´ìŠ¤ ê¸°ì‚¬ ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°](#ë„¤ì´ë²„-ë‰´ìŠ¤-ê¸°ì‚¬-ëŒ“ê¸€-ê°€ì ¸ì˜¤ê¸°)
    - [1. URL ê°€ì ¸ì˜¤ê¸°](#1-url-ê°€ì ¸ì˜¤ê¸°)
      - [âš ï¸ ì˜ëª»ëœ ì ‘ê·¼?](#ï¸-ì˜ëª»ëœ-ì ‘ê·¼)
      - [í›„ì²˜ë¦¬](#í›„ì²˜ë¦¬)
    - [2. ëŒ“ê¸€ë§Œ ê°€ì ¸ì˜¤ê¸°](#2-ëŒ“ê¸€ë§Œ-ê°€ì ¸ì˜¤ê¸°)
    - [3. ë°ì´í„° ì „ì²˜ë¦¬](#3-ë°ì´í„°-ì „ì²˜ë¦¬)
    - [4. ë” ë§ì€ ëŒ“ê¸€ ìˆ˜ì§‘í•˜ê¸°](#4-ë”-ë§ì€-ëŒ“ê¸€-ìˆ˜ì§‘í•˜ê¸°)
    - [5. ë§ˆë¬´ë¦¬í•˜ë©´ì„œ](#5-ë§ˆë¬´ë¦¬í•˜ë©´ì„œ)

---

## ë„¤ì´ë²„ ë‰´ìŠ¤ ê¸°ì‚¬ ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°
ë©‹ì‚¬ AIì—ì„œ ë¯¸ë‹ˆí”„ë¡œì íŠ¸1ì„ ì§„í–‰í•˜ë©´ì„œ ê¸°ì–µí•˜ë©´ ì¢‹ì„ ì ì„ ê¸°ë¡í•´ë†“ìœ¼ë ¤ê³  í•œë‹¤. ì•„ë˜ì˜ ë°©ë²•ì€ 'ë”ë³´ê¸°'ë¥¼ ëˆ„ë¥¼ ì •ë„ë¡œ ë§ì€ ë‰´ìŠ¤ ê¸°ì‚¬ 1ê°œì— ëŒ€í•œ ëŒ“ê¸€ì„ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ì´ë‹¤. ì…€ë ˆë‹ˆì›€ì„ ì“°ë©´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì„ requestë¡œ ì‰½ê²Œ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.

![naver_news](/assets/img/naver_news_comment/naver_news.png){: width="100%" height="100%"}

### 1. URL ê°€ì ¸ì˜¤ê¸°
ë‰´ìŠ¤ ê¸°ì‚¬ ëŒ“ê¸€ ë¶€ë¶„ìœ¼ë¡œ ë“¤ì–´ê°€ë©´ í•´ë‹¹ ê¸°ì‚¬ì— ëŒ€í•œ ëŒ“ê¸€ë§Œ ë³¼ ìˆ˜ ìˆë‹¤. ì´ í˜ì´ì§€ì—ì„œ ë§ˆìš°ìŠ¤ ìš°í´ë¦­ > ê²€ì‚¬ (Inspect) > Networkë¥¼ ëˆŒëŸ¬ ë‹¤ìŒê³¼ ê°™ì€ ì°½ì´ ë‚˜ì˜¤ë©´ ğŸš« í‘œì‹œë¥¼ ëˆŒëŸ¬ ì´ˆê¸°í™”í•´ì¤€ë‹¤. <br/><br/>
![initialize_log](/assets/img/naver_news_comment/initialize_log.png){: width="70%" height="70%"} <br/><br/>
ì—¬ê¸°ì„œ ë°‘ìœ¼ë¡œ ìŠ¤í¬ë¡¤ì„ ë‚´ë¦¬ë©´ ë³´ì´ëŠ” **`ë”ë³´ê¸°`** ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ë©´ JS requestê°€ ìƒˆë¡œ ìƒê¸´ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/><br/>
![comment_more](/assets/img/naver_news_comment/comment_more.png){: width="100%" height="100%"} <br/><br/>
![headers_requesturl](/assets/img/naver_news_comment/headers_requesturl.png){: width="100%" height="100%"} <br/><br/>
urlì€ ì´ ë¶€ë¶„ì˜ **`Headers`**ì— ìˆëŠ” **`Request URL`**ì„ ì°¸ê³ í•´ì„œ ê°€ì ¸ì˜¬ ê²ƒì´ë‹¤. <br/> 
**`user-agent`** ëŠ” í¬ë¡¬ì—ì„œ **[chrome://version/](chrome://version/)**ë¥¼ ì…ë ¥í•˜ë©´ í™•ì¸í•  ìˆ˜ ìˆë‹¤!




```python
news_url = "https://apis.naver.com/commentBox/cbox/web_naver_list_jsonp.json?ticket=news&templateId=default_it&pool=cbox5&_cv=20220927151452&_callback=jQuery331019634359292220194_1664536607172&lang=ko&country=KR&objectId=news016%2C0002042395&categoryId=&pageSize=20&indexSize=10&groupId=&listType=OBJECT&pageType=more&page=2&currentPage=1&refresh=false&sort=NEW&current=769851649379270841&prev=770466116173561900&moreParam.direction=next&moreParam.prev=05uqbfzh04gfg&moreParam.next=05uk9mtbnv5ix&followSize=100&includeAllStatus=true&_=1664536607175"

header = {"user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36"}
html = requests.get(url, headers = header)
soup = bs(html.content, 'html.parser')
soup
```


ìœ„ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ json í˜•íƒœì˜ ê²°ê³¼ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 

```
jQuery331019634359292220194_1664536607172({"success":false,"code":"3999","message":"ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.","lang":"ko","country":"KR","result":{},"date":"2022-09-30T11:22:13+0000"});
```
<br/>

#### âš ï¸ ì˜ëª»ëœ ì ‘ê·¼?

ì´ë¯¸ ë¡œë´‡ì´ ì•„ë‹˜ì„ ì¦ëª…í•˜ëŠ” user-agentë¥¼ ì¶”ê°€í•´ì¤¬ëŠ”ë° ë¬´ì—‡ì´ ë¬¸ì œì¼ê¹Œ? 

êµ¬ê¸€ë§ ê²°ê³¼, ë‹¤ìŒ [ë§í¬](https://m.blog.naver.com/PostView.nhn?blogId=codingspecialist&logNo=221336552535&categoryNo=100&proxyReferer=https:%2F%2Fwww.google.com%2F)ì—ì„œ ë‹µì„ ì°¾ì•˜ë‹¤. 
ì˜ëª»ëœ ì ‘ê·¼ì´ë¼ê³  ëœ¬ë‹¤ë©´ ì´ëŠ” ì´ì „ í˜ì´ì§€ì— ëŒ€í•œ ì°¸ì¡°ê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. ë„¤ì´ë²„ ë‰´ìŠ¤ì˜ ëŒ“ê¸€ì€ `ë”ë³´ê¸°` ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ëŒ“ê¸€ì„ ë” ë³¼ ìˆ˜ ìˆëŠ” í˜•íƒœì´ê¸° ë•Œë¬¸ì— ì´ì „ í˜ì´ì§€ë¥¼ ì°¸ì¡°í•œë‹¤. ì´ë¥¼ ë‚˜íƒ„íƒœëŠ” 'referer' ê°’ì„ ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. <br/>

```python
header = {"user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36",
            "referer" : "https://n.news.naver.com/article/comment/016/0002042395"}

html = requests.get(url, headers = header)
soup = bs(html.content, 'html.parser')
soup
```
'referer'ì„ ì¶”ê°€í•˜ì—¬ ì‹¤í–‰í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ "**ìš”ì²­ì„ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.**"ì™€ ê°™ì€ ë©”ì‹œì§€ê°€ ëœ¨ë©´ì„œ ëŒ“ê¸€ì„ ë°›ì•„ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. <br/>


![message_success](/assets/img/naver_news_comment/message_success.png){: width="100%" height="100%"} <br/><br/>


#### í›„ì²˜ë¦¬

**`jQuery331019634359292220194_1664536607172`**ë¡œ ê°ì‹¸ì ¸ ìˆëŠ” ë¶€ë¶„ë§Œ ì¶”ì¶œí•´ì˜¤ê¸° ìœ„í•´ **`_callback`** ë¶€ë¶„ì„ urlì—ì„œ ë¹¼ì¤€ë‹¤. ì´ë ‡ê²Œ í•œ ë’¤ ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•´ì£¼ë©´ ì € ê¸´ `jQuery~` ëŒ€ì‹  **`_callback`**ìœ¼ë¡œ ê°ì‹¸ì ¸ ìˆëŠ” êµ¬ì¡°ë¡œ ë°”ë€ë‹¤. ì´ì™¸ì— ì¡°ê¸ˆì˜ íŒŒë¼ë¯¸í„° ì¡°ì •ì„ í†µí•´ ë‚´ê°€ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ë„ë¡ í•´ë³´ì. urlì˜ íŒŒë¼ë¯¸í„°ëŠ” ë‹¤ìŒ ì½”ë“œë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 
```python
# urlì— ë¶™ì€ parameter í™•ì¸í•˜ê¸°
from urllib.parse import urlparse, parse_qs
url_param = parse_qs(urlparse(url).query)
url_param
```
![url_parameter](/assets/img/naver_news_comment/url_parameter.png){: width="50%" height="50%"} <br/><br/>

ìœ„ì˜ ê²°ê³¼ë¥¼ ì°¸ê³ í•´ì„œ url ì£¼ì†Œë¥¼ ì¡°ê¸ˆ ë°”ê¿”ì£¼ì—ˆë‹¤. ì—¬ê¸°ì„œ pageSizeëŠ” ìˆ˜ì§‘í•´ ì˜¬ ëŒ“ê¸€ì˜ ê°œìˆ˜ë¥¼ ì˜ë¯¸í•œë‹¤. ë‚˜ëŠ” í˜„ì¬ **`sort=NEW`**ë¡œ, ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆì§€ë§Œ ê³µê°ìˆœìœ¼ë¡œ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´ **`sort=favorite`**ìœ¼ë¡œ ë°”ê¾¸ë©´ ëœë‹¤.
```python
news_url = "https://apis.naver.com/commentBox/cbox/web_naver_list_jsonp.json?ticket=news&templateId=default_it&pool=cbox5&_cv=20220927151452&lang=ko&country=KR&objectId=news016,0002042395&pageSize=100&indexSize=10&listType=OBJECT&pageType=more&page=1&refresh=false&sort=NEW&current=769851649379270841&prev=770466116173561900&moreParam.direction=next&moreParam.prev=05uqbfzh04gfg&moreParam.next=05uk9mtbnv5ix&followSize=100&includeAllStatus=true&_=1664536607175"
header = {"user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36",
          "accept": "*/*",
          "accept-encoding": "gzip, deflate, br",
          "accept-language": "ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7",
          "referer" : "https://n.news.naver.com/article/comment/016/0002042395"}
html = requests.get(news_url, headers = header)
```

ì´ì œ ì›í•˜ëŠ” ë¶€ë¶„ë§Œ ë½‘ê¸° ìœ„í•´ **`_callback`** ë¶€ë¶„ì„ ì œê±°í•´ì„œ key - value ì ‘ê·¼ì´ í¸í•œ json ê°’ìœ¼ë¡œ ë³€í™˜í•´ì£¼ì. 
```python
# json íŒŒì¼ë¡œ ë³€í™˜í•´ì£¼ê¸°
news_text = html.text
news_text = news_text.replace("_callback(","")
comment_text = json.loads(news_text[:-2])
```
<br/>

### 2. ëŒ“ê¸€ë§Œ ê°€ì ¸ì˜¤ê¸°
**`comment_text`**ì—ì„œ ëŒ“ê¸€ë§Œ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ê² ë‹¤.<br/>

![comment_text](/assets/img/naver_news_comment/comment_text.png){: width="100%" height="100%"} <br/><br/>


ëŒ“ê¸€ì€ **`comment_text`**ì˜ 'contents'ì— ìœ„ì¹˜í•´ ìˆë‹¤.
```python
temp_comment_list = [comment_info['contents'] for comment_info in comment_text['result']['commentList']]
comment_all.extend(temp_comment_list)
comment_all
```
ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ëŒ“ê¸€ì´ **`list`** í˜•íƒœë¡œ ì˜ ë‹´ê²¨ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. <br/>

![comment_all](/assets/img/naver_news_comment/comment_all.png){: width="100%" height="100%"} <br/><br/>

### 3. ë°ì´í„° ì „ì²˜ë¦¬

ìœ„ì—ì„œ ëŒ“ê¸€ì˜ íŠ¹ì„±ìƒ íŠ¹ìˆ˜ ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ê°œí–‰ë¬¸ìëŠ” ë¬¸ì '\n'ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤. re ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ íŠ¹ìˆ˜ë¬¸ìë¥¼ ì œê±°í•´ì£¼ê³ , replaceë¥¼ ì´ìš©í•´ '\n'ì„ ì œê±°í•´ì£¼ê² ë‹¤.
```python
re_comment = []
for comment in comment_all:
    c = re.sub('[^\w\s]', '', comment)
    c = c.replace('\n', ' ')
    re_comment.append(c)
```
<br/>

ì´ë¥¼ ë°ì´í„°í”„ë ˆì„ í˜•íƒœë¡œ ë‚˜íƒ€ë‚´ì£¼ì—ˆë”ë‹ˆ **ê³µë°±**ìœ¼ë¡œ ì¶œë ¥ë˜ëŠ” í–‰ì´ ìˆì—ˆë‹¤. í™•ì¸í•´ë³´ë‹ˆ, ì´ëŠ” ì‚­ì œëœ ëŒ“ê¸€ì´ì—ˆë‹¤. ì´ë¥¼ ëª¨ë‘ "**====== ì‚­ì œëœ ëŒ“ê¸€ì…ë‹ˆë‹¤. ======**"ìœ¼ë¡œ ë°”ê¿”ì£¼ì—ˆë‹¤. 
```python
# ''ë¡œ ì¶œë ¥ë˜ëŠ” í–‰ -> 'ì‚­ì œëœ ëŒ“ê¸€ì…ë‹ˆë‹¤'ë¡œ ë³€ê²½
df = comment_df_final.copy()
for i in range(len(df)):
    if len(df['comment'][i]) == 0:
        df['comment'][i] = "====== ì‚­ì œëœ ëŒ“ê¸€ì…ë‹ˆë‹¤. ======"
```
![result_comment](/assets/img/naver_news_comment/result_comment.png){: width="70%" height="70%"} <br/><br/>

### 4. ë” ë§ì€ ëŒ“ê¸€ ìˆ˜ì§‘í•˜ê¸°
ì, ì‘ìš©í•´ì„œ 'ë”ë³´ê¸°'ë¥¼ ì›í•˜ëŠ” íšŸìˆ˜ë§Œí¼ ëˆŒëŸ¬ ëŒ“ê¸€ì„ ê°€ì ¸ì™€ë³´ì!

```python
news_url = "https://apis.naver.com/commentBox/cbox/web_naver_list_jsonp.json?ticket=news&templateId=default_it&pool=cbox5&_cv=20220927151452&lang=ko&country=KR&objectId=news016,0002042395&pageSize=80&indexSize=10&listType=OBJECT&pageType=more&page={}&refresh=false&sort=NEW&current=769851649379270841&prev=770466116173561900&moreParam.direction=next&moreParam.prev=05uqbfzh04gfg&moreParam.next=05uk9mtbnv5ix&followSize=100&includeAllStatus=true&_=1664536607175"
header = {"user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7",
            "referer" : "https://n.news.naver.com/article/comment/016/0002042395"}
```

format í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ ì›í•˜ëŠ” ê°’ì„ urlì— ë„£ì–´ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ì´ìš©í•˜ì. ìˆ˜ì§‘í•  ì´ ëŒ“ê¸€ ìˆ˜ê°€ ìµœì†Œ 100ê°œê°€ ë˜ë„ë¡ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. 

```python
page_no = 1
comment_all = []

while True:
    req_url = news_url.format(page_no)
    html = requests.get(req_url, headers = header)

    news_text = html.text
    news_text = news_text.replace("_callback(","")
    comment_text = json.loads(news_text[:-2])

    temp_comment_list = [comment_info['contents'] for comment_info in comment_text['result']['commentList']]
    comment_all.extend(temp_comment_list)
    page_no+=1
    if len(comment_all) > 100:
        break
```


### 5. ë§ˆë¬´ë¦¬í•˜ë©´ì„œ
ì´ë ‡ê²Œ ë‰´ìŠ¤ê¸°ì‚¬ 1ê°œì— ëŒ€í•œ ëŒ“ê¸€ì„ ìˆ˜ì§‘í•˜ëŠ” ì½”ë“œë¥¼ ì§œë´¤ë‹¤. ë‹¤ìŒì—” [ì°¸ê³  ì‚¬ì´íŠ¸](https://hoonzi-text.tistory.com/4)ë¥¼ ì°¸ê³ í•´ì„œ ë” ë§ì€ ê¸°ì‚¬ì— ëŒ€í•œ ëŒ“ê¸€ì„ ì›¹ìŠ¤í¬ë˜í•‘í•´ë³´ë„ë¡ í•˜ì.